#!/usr/bin/env sh
set -eu

ROOT_DIR=$(CDPATH= cd -- "$(dirname -- "$0")" && pwd)
RUNTIME="$ROOT_DIR/build/cyper"

if [ ! -x "$RUNTIME" ]; then
  if command -v make >/dev/null 2>&1; then
    make -C "$ROOT_DIR" build/cyper >/dev/null
  else
    echo "Error: build/cyper is missing and 'make' is not available" >&2
    exit 1
  fi
fi

exec "$RUNTIME" "$@"
